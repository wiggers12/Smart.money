<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>pix.com - Sorteio Pix</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-in {
      animation: fadeIn 2s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body class="bg-white text-gray-800 font-sans">

<!-- Splash Screen -->
<div id="splash" class="fixed inset-0 flex items-center justify-center bg-blue-600 text-white text-3xl font-bold z-50">
  <div class="text-center">
    <div class="text-5xl mb-4">pix.com</div>
    <div class="text-sm">Sorteio de Pix InstantÃ¢neo</div>
  </div>
</div>

<!-- TELA PRINCIPAL -->
<section id="mainView" class="fade-in max-w-md mx-auto mt-10 p-6 bg-gray-100 rounded-lg shadow hidden">
  <h1 class="text-2xl font-bold text-blue-600 mb-4 text-center">pix.com - Sorteio Pix</h1>
  <p class="text-center text-sm mb-2 text-gray-600">Inscreva-se e concorra ao prÃªmio abaixo:</p>
  <p class="text-center font-bold text-green-600 mb-2">ğŸ PrÃªmio: <span id="premioDisplay">Carregando...</span></p>
  <p class="text-center font-semibold text-yellow-600 mb-1">Status: <span id="statusText">Carregando...</span></p>
  <p class="text-center text-sm mb-4 text-red-600">Encerramento: <span id="countdown">--:--</span></p>

  <input type="text" id="instagramHandle" class="border p-2 w-full rounded mb-2" placeholder="@seuInstagram" />
  <input type="text" id="pixKey" class="border p-2 w-full rounded mb-2" placeholder="Chave Pix" />
  <button id="registerButton" class="bg-blue-500 hover:bg-blue-600 text-white w-full py-2 rounded mb-4 font-bold">Quero Participar</button>

  <ul id="participantsList" class="text-sm mb-2"></ul>
  <p id="loadingParticipants" class="text-center text-gray-400">Carregando participantes...</p>

  <p class="text-xs text-gray-500 mt-4">Seu ID: <span id="userIdDisplay"></span></p>
  <p class="text-center mt-2"><a href="#" id="adminLink" class="text-blue-500 text-sm underline">Acesso Admin</a></p>
</section>

<!-- Firebase + Script -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDZ2jr8QhV2p4IgcN2x-_fKBv3yeH7mUQU",
  authDomain: "smart-5a1c5.firebaseapp.com",
  projectId: "smart-5a1c5",
  storageBucket: "smart-5a1c5.appspot.com",
  messagingSenderId: "138657213190",
  appId: "1:138657213190:web:1652d65b2d6b2d7aefcc87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Splash screen timeout
setTimeout(() => {
  document.getElementById("splash").style.display = "none";
  document.getElementById("mainView").classList.remove("hidden");
}, 2000);

// Views
const userId = localStorage.getItem("userId") || Math.random().toString(36).substr(2, 9);
localStorage.setItem("userId", userId);
document.getElementById("userIdDisplay").textContent = userId;

// Verifica status
async function verificarStatus() {
  const snap = await getDoc(doc(db, "sorteio", "status"));
  if (!snap.exists()) return;
  const dados = snap.data();
  document.getElementById("statusText").textContent = dados.ativo ? "InscriÃ§Ãµes Abertas" : "Encerradas";
  document.getElementById("premioDisplay").textContent = dados.premio || "NÃ£o informado";
  if (dados.encerramento) iniciarContador(dados.encerramento, dados.ativo);
}
verificarStatus();

// Registrar
document.getElementById("registerButton").onclick = async () => {
  const statusSnap = await getDoc(doc(db, "sorteio", "status"));
  if (!statusSnap.exists() || !statusSnap.data().ativo) {
    alert("InscriÃ§Ãµes encerradas.");
    return;
  }
  const instagram = instagramHandle.value.trim();
  const chavePix = pixKey.value.trim();
  if (!instagram || !chavePix) return alert("Preencha os campos.");
  await setDoc(doc(db, "participantes", userId), {
    instagram, chavePix, data: new Date().toISOString()
  });

  const msg = `âœ… ConfirmaÃ§Ã£o de InscriÃ§Ã£o no pix.com!\n\nğŸ§ Instagram: ${instagram}\nğŸ”‘ Pix: ${chavePix}\nğŸ PrÃªmio: ${statusSnap.data().premio || "A definir"}\nğŸ“… Boa sorte!`;
  const link = `https://wa.me/?text=${encodeURIComponent(msg)}`;
  window.open(link, "_blank");

  alert("InscriÃ§Ã£o confirmada e comprovante enviado via WhatsApp!");
};

// Participantes ao vivo
onSnapshot(collection(db, "participantes"), snap => {
  const lista = document.getElementById("participantsList");
  lista.innerHTML = "";
  snap.forEach(doc => {
    const li = document.createElement("li");
    li.textContent = doc.data().instagram;
    lista.appendChild(li);
  });
  document.getElementById("loadingParticipants").style.display = "none";
});

// Contador regressivo
function iniciarContador(encerramentoStr, ativo) {
  const target = new Date(encerramentoStr);
  const countdown = document.getElementById("countdown");
  const timer = setInterval(async () => {
    const now = new Date();
    const diff = target - now;
    if (diff <= 0) {
      clearInterval(timer);
      countdown.textContent = "Encerrado";
      if (ativo) await updateDoc(doc(db, "sorteio", "status"), { ativo: false });
      return;
    }
    const hrs = String(Math.floor(diff / 3600000)).padStart(2, '0');
    const min = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
    countdown.textContent = `${hrs}:${min}`;
  }, 1000);
}

// Admin acesso (exemplo bÃ¡sico)
document.getElementById("adminLink").onclick = () => {
  alert("Admin: acesse manualmente via painel privado.");
};
</script>

</body>
</html>