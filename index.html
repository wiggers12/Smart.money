<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Jogo de Alfabetiza√ß√£o ‚Ä¢ Quiz</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#f0f9ff; --card:#ffffff; --primary:#0077b6; --primary-2:#00b4d8;
      --text:#0b2942; --muted:#6b7280; --good:#10b981; --warn:#f59e0b; --danger:#ef4444;
      --shadow:0 8px 30px rgba(0,0,0,.08); --radius:18px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text); background:linear-gradient(180deg,var(--bg),#fff); display:flex; flex-direction:column}
    .wrap{flex:1; display:flex; flex-direction:column}
    .tela{display:none; flex:1; align-items:center; justify-content:center; padding:20px}
    .tela.ativa{display:flex}
    .container{width:min(980px,100%); margin:0 auto; display:flex; flex-direction:column; gap:18px; align-items:center}
    .card{width:100%; background:var(--card); border-radius:var(--radius); padding:22px; box-shadow:var(--shadow)}
    h1,h2,h3{margin:0} h1{font-size:clamp(20px,4.5vw,36px)} h2{font-size:clamp(18px,3.5vw,28px)}
    p{margin:0; color:var(--muted)}
    /* splash */
    #splash{background:linear-gradient(135deg,var(--primary),var(--primary-2)); color:#fff; text-align:center}
    .logo{font-weight:900}
    button{appearance:none; border:0; border-radius:14px; padding:14px 18px; cursor:pointer;
      background:var(--primary); color:#fff; font-weight:700; letter-spacing:.2px;
      box-shadow:0 6px 16px rgba(0,119,182,.18); transition:.2s transform,.2s background}
    button:hover{transform:translateY(-1px); background:var(--primary-2)} button:active{transform:translateY(0)}
    .btn-ghost{background:#f1f5f9; color:var(--text)} .btn-outline{background:#fff;color:var(--primary);border:2px solid var(--primary)}
    .grid{display:grid; gap:14px} .grid.cols-2{grid-template-columns:repeat(2,1fr)} .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    @media (max-width:760px){.grid.cols-3{grid-template-columns:repeat(2,1fr)} .grid.cols-2{grid-template-columns:1fr}}
    .big{font-size:clamp(36px,10vw,70px); font-weight:900; text-align:center; padding:16px; border-radius:16px; background:#fafcff; border:2px dashed #e2e8f0}
    .sub{font-size:clamp(16px,3.2vw,22px); color:var(--muted)}
    .row{display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap}
    .progress{height:10px; width:100%; background:#eef2f7; border-radius:999px; overflow:hidden}
    .progress>span{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--primary),var(--primary-2))}
    .pill{background:#eff6ff; color:#0369a1; padding:8px 12px; border-radius:999px; font-weight:700}
    .stars{display:flex; gap:6px} .star{font-size:26px; filter:grayscale(1) opacity(.6)} .star.on{filter:none}
    /* op√ß√µes do quiz */
    .opcoes{display:grid; gap:12px; grid-template-columns:repeat(2,1fr)}
    .op{padding:14px; border-radius:12px; background:#fff; border:2px solid #e2e8f0; text-align:center; font-size:clamp(20px,5vw,32px); cursor:pointer}
    .op:hover{border-color:#cbd5e1}
    .op.certa{border-color:#10b981; background:#ecfdf5} .op.errada{border-color:#ef4444; background:#fef2f2}
    /* DnD */
    .drop{min-height:72px; background:#f8fafc; border:2px dashed #cbd5e1; border-radius:12px; padding:10px; display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap}
    .chip{display:inline-flex; align-items:center; justify-content:center; padding:10px 14px; border-radius:12px; background:#e0f2fe; border:2px solid #bae6fd; font-weight:800; cursor:grab; user-select:none}
    .chip[draggable="true"]:active{cursor:grabbing}
    /* confete */
    #confetti{pointer-events:none; position:fixed; inset:0; overflow:hidden}
    .c{position:absolute; width:10px; height:14px; opacity:.9; transform:translate(-50%,-50%) rotate(0deg)}
    @keyframes fall{to{transform:translate(var(--tx,0),110vh) rotate(720deg)}}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- SPLASH -->
    <section id="splash" class="tela ativa">
      <div class="container" style="max-width:820px">
        <div class="card" style="text-align:center; color:#0b2942; background:rgba(255,255,255,.14); backdrop-filter: blur(6px);">
          <h1 class="logo">üéâ Jogo de Alfabetiza√ß√£o</h1>
          <p style="margin-top:8px">Agora com <b>Modo Quiz</b>: m√∫ltipla escolha e montar palavras por s√≠labas.</p>
          <div class="row" style="margin-top:12px">
            <button id="btnAtivarAudio">üîà Ativar √°udio</button>
            <button class="btn-outline" id="btnEntrar">Entrar</button>
          </div>
          <p style="margin-top:10px;opacity:.8">Dica: alguns navegadores s√≥ liberam a voz ap√≥s um clique.</p>
        </div>
      </div>
    </section>

    <!-- MENU -->
    <section id="menu" class="tela">
      <div class="container" style="max-width:980px">
        <div class="card">
          <h2>Escolha um modo</h2>
          <div class="grid cols-3" role="menu" aria-label="Modos de jogo">
            <button role="menuitem" onclick="iniciarFase('alfabeto')">üî§ Alfabeto</button>
            <button role="menuitem" onclick="iniciarFase('vogais')">üÖ∞Ô∏è Vogais</button>
            <button role="menuitem" onclick="iniciarFase('consoantes')">üÖ±Ô∏è Consoantes</button>
            <button role="menuitem" onclick="abrirMenuSilabas()">üî° S√≠labas</button>
            <button role="menuitem" onclick="abrirQuiz()">üéØ Quiz</button>
          </div>
        </div>

        <div class="card">
          <h3>Controles de √°udio</h3>
          <div class="row">
            <label class="pill">Velocidade</label>
            <input id="velocidade" type="range" min="0.6" max="1.2" step="0.1" value="0.9" />
            <span id="velocidadeVal" class="pill" style="background:#eef2f7;color:#334155">0.9x</span>
            <button class="btn-ghost" id="btnTestVoice">üîä Testar Voz</button>
          </div>
          <div class="row" style="margin-top:6px">
            <label class="pill">Voz</label>
            <select id="vozSelect" style="padding:10px 12px; border-radius:10px; border:1px solid #cbd5e1"></select>
          </div>
        </div>
      </div>
    </section>

    <!-- MENU S√çLABAS -->
    <section id="menuSilabas" class="tela">
      <div class="container" style="max-width:900px">
        <div class="card">
          <h2>Quantidade de s√≠labas</h2>
          <div id="listaSilabas" class="grid cols-3"></div>
          <div class="row" style="margin-top:10px"><button class="btn-ghost" onclick="voltarMenu()">‚¨ÖÔ∏è Voltar</button></div>
        </div>
      </div>
    </section>

    <!-- FASE (ESTUDO) -->
    <section id="fase" class="tela" aria-live="polite">
      <div class="container" style="max-width:980px">
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <h2 id="tituloFase">‚Äî</h2>
            <div class="row">
              <div class="stars"><span id="s1" class="star">‚≠ê</span><span id="s2" class="star">‚≠ê</span><span id="s3" class="star">‚≠ê</span></div>
              <span class="pill" style="margin-left:8px">Pos <span id="posAtual">0</span>/<span id="posTotal">0</span></span>
            </div>
          </div>
          <div class="progress" style="margin-top:12px"><span id="barraProgresso"></span></div>
        </div>

        <div class="card" style="text-align:center">
          <div id="pergunta" class="big">‚Äî</div>
          <div id="subtexto" class="sub">‚Äî</div>
        </div>

        <div class="card">
          <div class="row">
            <button class="btn-ghost" id="btnAnterior">‚¨ÖÔ∏è Anterior</button>
            <button id="btnFalar">üîä Falar</button>
            <button class="btn-outline" id="btnPausar">‚è∏Ô∏è Pausar</button>
            <button id="btnProxima">‚û°Ô∏è Pr√≥xima</button>
            <button class="btn-ghost" onclick="voltarMenu()">‚¨ÖÔ∏è Menu</button>
          </div>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="quiz" class="tela">
      <div class="container" style="max-width:980px">
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <h2>üéØ Modo Quiz</h2>
            <div class="row">
              <span class="pill">Pontos: <b id="pontos">0</b></span>
              <span class="pill">Streak: <b id="streak">0</b></span>
              <span class="pill">Quest√£o <span id="qAtual">0</span>/<span id="qTotal">0</span></span>
            </div>
          </div>
          <div class="progress" style="margin-top:12px"><span id="barraQuiz"></span></div>
        </div>

        <div class="card" style="text-align:center">
          <div id="qTexto" class="big">‚Äî</div>
          <div id="qSub" class="sub">‚Äî</div>
        </div>

        <!-- m√∫ltipla escolha -->
        <div id="qOpcoes" class="card" style="display:none">
          <div class="opcoes" id="opcoes"></div>
        </div>

        <!-- arrastar e soltar -->
        <div id="qDnD" class="card" style="display:none">
          <div class="sub" style="margin-bottom:8px">Arraste as s√≠labas para completar a palavra:</div>
          <div id="drop" class="drop" aria-label="√Årea de montagem"></div>
          <div class="row" style="margin-top:10px; justify-content:center">
            <div id="banco" class="drop" aria-label="S√≠labas dispon√≠veis"></div>
          </div>
        </div>

        <div class="card">
          <div class="row">
            <button class="btn-ghost" onclick="voltarMenu()">‚¨ÖÔ∏è Sair do Quiz</button>
            <button id="btnProxQuiz">‚û°Ô∏è Pr√≥xima</button>
            <button class="btn-outline" id="btnReiniciar">üîÅ Reiniciar</button>
          </div>
        </div>

        <div class="card" id="resumo" style="display:none; text-align:center">
          <h3>Resultado</h3>
          <p class="sub" id="resumoTxt">‚Äî</p>
        </div>
      </div>
    </section>
  </div>

  <!-- confete -->
  <div id="confetti"></div>

  <script>
    /* ===== Dados base ===== */
    const pronunciaLetras = {
      A:"A", B:"b√™", C:"c√™", D:"d√™", E:"√ä", F:"EFE", G:"g√™", H:"ag√°", I:"i",
      J:"j√≥ta", K:"c√°", L:"√©le", M:"√™me", N:"N", O:"√≥", P:"p√™", Q:"qu√™",
      R:"√©rre", S:"S", T:"t√™", U:"u", V:"v√™", W:"d√°blio", X:"xis", Y:"√≠psilon", Z:"z√™"
    };
    const alfabeto = Array.from({length:26},(_,i)=>String.fromCharCode(65+i));
    const vogais = ["A","E","I","O","U","√ÉO"];
    const consoantes = alfabeto.filter(l=>!vogais.includes(l));

    const palavrasSilabas = {
      2: [
        {partes:["B√ì","LA"], palavra:"BOLA"},
        {partes:["CA","SA"], palavra:"CASA"},
        {partes:["PA","TO"], palavra:"PATO"},
        {partes:["GA","TO"], palavra:"GATO"},
        {partes:["LI","VRO"], palavra:"LIVRO"}
      ],
      3: [
        {partes:["CA","DEI","RA"], palavra:"CADEIRA"},
        {partes:["JA","NE","LA"], palavra:"JANELA"},
        {partes:["SO","RVE","TE"], palavra:"SORVETE"}
      ],
      4: [
        {partes:["A","MA","RE","LO"], palavra:"AMARELO"},
        {partes:["TE","LE","VI","S√ÉO"], palavra:"TELEVIS√ÉO"}
      ]
    };
    const opcoesSilabas = Object.keys(palavrasSilabas).map(n=>+n).sort((a,b)=>a-b);

    /* ===== Estado global curto (estudo) ===== */
    const state = {
      fase:"", lista:[], indice:0, qtdSilabas:null,
      velocidade:0.9, vozURI:null
    };

    /* ===== DOM ===== */
    const telas = { splash:qs("#splash"), menu:qs("#menu"), menuSilabas:qs("#menuSilabas"), fase:qs("#fase"), quiz:qs("#quiz") };
    const tituloFase = qs("#tituloFase"), pergunta = qs("#pergunta"), subtexto = qs("#subtexto");
    const posAtual = qs("#posAtual"), posTotal = qs("#posTotal"), barraProgresso = qs("#barraProgresso");

    // √Åudio
    const velocidade = qs("#velocidade"), velocidadeVal = qs("#velocidadeVal"), vozSelect = qs("#vozSelect");

    // Estudo controles
    qs("#btnEntrar").addEventListener("click", ()=>mostrarTela("menu"));
    qs("#btnAtivarAudio").addEventListener("click", ()=>falar("√Åudio ativado", 1.0, true));
    qs("#btnFalar").addEventListener("click", tocarItemAtual);
    qs("#btnPausar").addEventListener("click", ()=>speechSynthesis.cancel());
    qs("#btnAnterior").addEventListener("click", ()=>{ if(state.indice>0){state.indice--; atualizarPainel(); tocarItemAtual();} });
    qs("#btnProxima").addEventListener("click", ()=>{ if(state.indice<state.lista.length-1){state.indice++; atualizarPainel(); tocarItemAtual();} else fimDeFase(); });
    velocidade.addEventListener("input", ()=>{ state.velocidade = +velocidade.value; velocidadeVal.textContent = state.velocidade.toFixed(1)+"x"; });
    qs("#btnTestVoice").addEventListener("click", ()=>falar("Teste de voz em portugu√™s do Brasil", state.velocidade));

    // Menu s√≠labas
    const listaSilabas = qs("#listaSilabas");
    window.addEventListener("load", ()=>{
      listaSilabas.innerHTML = opcoesSilabas.map(n=>`<button onclick="iniciarSilabas(${n})">${n} s√≠labas</button>`).join("");
      popularVozes();
      velocidadeVal.textContent = Number(velocidade.value).toFixed(1)+"x";
      window.addEventListener("keydown", atalhos);
    });

    /* ===== Navega√ß√£o telas ===== */
    function mostrarTela(id){ Object.values(telas).forEach(t=>t.classList.remove("ativa")); telas[id].classList.add("ativa"); }
    function voltarMenu(){ mostrarTela("menu"); }

    function abrirMenuSilabas(){ mostrarTela("menuSilabas"); }
    function abrirQuiz(){ iniciarQuiz(); mostrarTela("quiz"); }

    /* ===== Estudo (modo antigo) ===== */
    function iniciarFase(nome){
      state.fase = nome; state.indice=0; state.qtdSilabas=null;
      state.lista = (nome==="alfabeto"? [...alfabeto] : nome==="vogais"? [...vogais] : nome==="consoantes"? [...consoantes] : []);
      configurarTitulo(); atualizarPainel(); mostrarTela("fase"); tocarItemAtual();
    }
    function iniciarSilabas(qtd){
      state.fase="silabas"; state.indice=0; state.qtdSilabas=qtd; state.lista=[...(palavrasSilabas[qtd]||[])];
      configurarTitulo(); atualizarPainel(); mostrarTela("fase"); tocarItemAtual();
    }
    function configurarTitulo(){
      const t = state.fase==="alfabeto"?"üî§ Alfabeto": state.fase==="vogais"?"üÖ∞Ô∏è Vogais":
                state.fase==="consoantes"?"üÖ±Ô∏è Consoantes": `üî° ${state.qtdSilabas} s√≠labas`;
      tituloFase.textContent = t; posTotal.textContent = (state.fase==="silabas"? state.lista.length : state.lista.length);
    }
    function atualizarPainel(){
      const total = state.lista.length||1, i=state.indice;
      posAtual.textContent = Math.min(i+1,total);
      barraProgresso.style.width = `${(i/total)*100}%`;
      if(state.fase==="silabas"){
        const item = state.lista[i]; if(!item){return fimDeFase();}
        pergunta.textContent = `${item.partes.join(" - ")} = ${item.palavra}`; subtexto.textContent="Repita comigo!";
      } else {
        const letra = state.lista[i]; if(!letra){return fimDeFase();}
        pergunta.textContent = letra; subtexto.textContent="Repita comigo!";
      }
    }
    function fimDeFase(){
      pergunta.textContent="üéâ Voc√™ terminou esta fase!"; subtexto.textContent=""; barraProgresso.style.width="100%";
      falar("Parab√©ns, voc√™ completou a fase!", state.velocidade);
    }
    function tocarItemAtual(){
      if(state.fase==="silabas"){
        const item = state.lista[state.indice]; if(!item) return;
        let delay=0;
        item.partes.forEach(parte=>{
          const fala = parte.split("").map(l=>pronunciaLetras[l]||l).join(" e o ");
          setTimeout(()=>falar(`${fala}, ${parte}`, state.velocidade), delay); delay+=2200;
        });
        setTimeout(()=>falar(item.partes.join(" - "), state.velocidade), delay);
      } else {
        const letra = state.lista[state.indice], nome = pronunciaLetras[letra]||letra;
        falar(`letra ${nome}`, state.velocidade);
        setTimeout(()=>falar(`letra ${nome}`, state.velocidade), 1600);
      }
    }

    /* ===== Voz ===== */
    function falar(texto, velocidade=0.9, force=false){
      if(!force && document.hidden){} // nada
      const msg = new SpeechSynthesisUtterance(texto);
      msg.lang="pt-BR"; msg.rate=Number(velocidade)||0.9;
      if(state.vozURI){ const v = speechSynthesis.getVoices().find(v=>v.voiceURI===state.vozURI); if(v) msg.voice=v; }
      else { const prefer = speechSynthesis.getVoices().find(v=>/pt(-|_)BR/i.test(v.lang)); if(prefer) msg.voice=prefer; }
      speechSynthesis.cancel(); speechSynthesis.speak(msg);
    }
    function popularVozes(){
      function fill(){
        const voices = speechSynthesis.getVoices();
        vozSelect.innerHTML="";
        const sorted=[...voices].sort((a,b)=>{const ap=/pt(-|_)BR/i.test(a.lang)?-1:1; const bp=/pt(-|_)BR/i.test(b.lang)?-1:1; return ap-bp||a.name.localeCompare(b.name);});
        sorted.forEach(v=>{const o=document.createElement("option"); o.value=v.voiceURI; o.textContent=`${v.name} (${v.lang})`; vozSelect.appendChild(o);});
        const prefer = sorted.find(v=>/pt(-|_)BR/i.test(v.lang)); vozSelect.value = prefer?.voiceURI || sorted[0]?.voiceURI || "";
        state.vozURI = vozSelect.value || null;
      }
      fill(); speechSynthesis.onvoiceschanged=fill;
      vozSelect.addEventListener("change", ()=>{ state.vozURI = vozSelect.value || null; });
    }

    /* ===== Quiz ===== */
    const QUIZ_TOTAL = 10; // quest√µes por sess√£o

    const quiz = {
      perguntas: [], idx: 0, pontos:0, streak:0,
      elTexto: qs("#qTexto"), elSub: qs("#qSub"), elOpcoes: qs("#qOpcoes"),
      elDnD: qs("#qDnD"), opcoesBox: qs("#opcoes"), drop: qs("#drop"), banco: qs("#banco"),
      pontosEl: qs("#pontos"), streakEl: qs("#streak"), qAtual: qs("#qAtual"), qTotal: qs("#qTotal"),
      barra: qs("#barraQuiz"), resumo: qs("#resumo"), resumoTxt: qs("#resumoTxt")
    };

    function abrirConfete(){
      const cont = qs("#confetti");
      for(let i=0;i<60;i++){
        const d = document.createElement("div");
        d.className="c";
        d.style.left = Math.random()*100+"vw";
        d.style.top = "-5vh";
        d.style.background = `hsl(${Math.random()*360},90%,60%)`;
        d.style.animation = `fall ${1.8+Math.random()*1.4}s linear forwards`;
        d.style.setProperty('--tx', (Math.random()*40-20)+'vw');
        cont.appendChild(d);
        setTimeout(()=>d.remove(), 3500);
      }
    }

    function gerarPerguntas(){
      const tipo1 = alfabeto; // letra certa
      const tipo2 = Object.values(palavrasSilabas).flat(); // montar palavra

      // Mistura e pega um conjunto equilibrado
      const perguntas = [];
      const letrasSh = shuffle([...tipo1]).slice(0, Math.ceil(QUIZ_TOTAL/2));
      const dndSh = shuffle([...tipo2]).slice(0, Math.floor(QUIZ_TOTAL/2));

      // Cria objetos de quest√µes
      letrasSh.forEach(L=>{
        // 3 distratores
        const pool = shuffle(alfabeto.filter(x=>x!==L)).slice(3);
        perguntas.push({ tipo:"mc", enunciado:"Qual √© a letra mostrada?", alvo:L, opcoes:shuffle([L, ...pool.slice(0,3)]) });
      });

      dndSh.forEach(item=>{
        perguntas.push({ tipo:"dnd", enunciado:"Monte a palavra pelas s√≠labas", alvo:item.palavra, partes:[...item.partes] });
      });

      return shuffle(perguntas).slice(0, QUIZ_TOTAL);
    }

    function iniciarQuiz(){
      quiz.perguntas = gerarPerguntas();
      quiz.idx=0; quiz.pontos=0; quiz.streak=0;
      quiz.qTotal.textContent = quiz.perguntas.length;
      quiz.resumo.style.display="none";
      atualizarHUDQuiz();
      mostrarQuestao();
    }

    function atualizarHUDQuiz(){
      quiz.pontosEl.textContent = quiz.pontos;
      quiz.streakEl.textContent = quiz.streak;
      quiz.qAtual.textContent = Math.min(quiz.idx+1, quiz.perguntas.length);
      quiz.barra.style.width = `${(quiz.idx/quiz.perguntas.length)*100}%`;
    }

    function mostrarQuestao(){
      const q = quiz.perguntas[quiz.idx];
      quiz.elTexto.textContent = q.enunciado;
      quiz.elSub.textContent = q.tipo==="mc" ? "Toque na alternativa correta" : "Arraste na ordem correta";
      quiz.elOpcoes.style.display = q.tipo==="mc" ? "block" : "none";
      quiz.elDnD.style.display = q.tipo==="dnd" ? "block" : "none";
      if(q.tipo==="mc") renderMC(q); else renderDnD(q);
      atualizarHUDQuiz();
    }

    function renderMC(q){
      quiz.opcoesBox.innerHTML = "";
      // Exibe a letra alvo grande
      quiz.elSub.innerHTML = `Letra: <b style="font-size:1.2em">${q.alvo}</b>`;
      q.opcoes.forEach(op=>{
        const b = document.createElement("button");
        b.className="op"; b.textContent = op;
        b.onclick = ()=>{
          if(b.dataset.done) return;
          const certo = (op===q.alvo);
          if(certo){
            b.classList.add("certa"); quiz.pontos+=10; quiz.streak++; falar("Muito bem!", state.velocidade); abrirConfete();
          } else {
            b.classList.add("errada"); quiz.streak=0; falar(`A resposta correta √© ${q.alvo}`, state.velocidade);
            // destacar a correta
            [...quiz.opcoesBox.children].forEach(x=>{ if(x.textContent===q.alvo) x.classList.add("certa"); });
          }
          b.dataset.done = "1";
          // bloquear cliques
          [...quiz.opcoesBox.children].forEach(x=>x.onclick=null);
        };
        quiz.opcoesBox.appendChild(b);
      });
    }

    function renderDnD(q){
      quiz.drop.innerHTML=""; quiz.banco.innerHTML="";
      const destino = document.createElement("div");
      destino.className="drop"; destino.style.minHeight="64px";
      quiz.drop.appendChild(destino);

      const partes = shuffle([...q.partes]); // banco embaralhado
      partes.forEach(p=>{
        const chip = document.createElement("div");
        chip.className="chip"; chip.textContent=p; chip.draggable=true;
        chip.addEventListener("dragstart", e=>{ e.dataTransfer.setData("text/plain", p); e.dataTransfer.effectAllowed="move"; chip.classList.add("ghost"); });
        chip.addEventListener("dragend", ()=>chip.classList.remove("ghost"));
        quiz.banco.appendChild(chip);
      });

      // DnD b√°sico
      ;[destino, quiz.banco].forEach(area=>{
        area.addEventListener("dragover", e=>{ e.preventDefault(); });
        area.addEventListener("drop", e=>{
          e.preventDefault();
          const texto = e.dataTransfer.getData("text/plain");
          const passando = [...quiz.banco.children].find(c=>c.textContent===texto);
          if(passando){ area.appendChild(passando); }
          checarDnD(q, destino);
        });
      });
    }

    function checarDnD(q, destino){
      const atual = [...destino.children].map(n=>n.textContent).join("");
      if(atual.length===q.alvo.length){
        const correto = (atual===q.partes.join(""));
        if(correto){
          quiz.pontos+=15; quiz.streak++; falar(`Palavra ${q.alvo}. Excelente!`, state.velocidade); abrirConfete();
        } else {
          quiz.streak=0; falar(`A palavra correta √© ${q.alvo}`, state.velocidade);
        }
        // trava arrastos
        [...qsAll(".chip")].forEach(c=>c.draggable=false);
      }
    }

    qs("#btnProxQuiz").addEventListener("click", ()=>{
      if(quiz.idx<quiz.perguntas.length-1){ quiz.idx++; mostrarQuestao(); }
      else finalizarQuiz();
    });
    qs("#btnReiniciar").addEventListener("click", iniciarQuiz);

    function finalizarQuiz(){
      quiz.barra.style.width="100%";
      quiz.resumo.style.display="block";
      quiz.resumoTxt.textContent = `Voc√™ fez ${quiz.pontos} pontos com streak m√°ximo ${quiz.streak}.`;
      falar("Quiz finalizado! Muito bem!", state.velocidade);
    }

    /* ===== Atalhos ===== */
    function atalhos(e){
      if(e.target.tagName==="INPUT"||e.target.tagName==="SELECT"||e.target.isContentEditable) return;
      if(e.code==="ArrowLeft"){ if(telas.fase.classList.contains("ativa")) qs("#btnAnterior").click(); }
      if(e.code==="ArrowRight"){
        if(telas.fase.classList.contains("ativa")) qs("#btnProxima").click();
        if(telas.quiz.classList.contains("ativa")) qs("#btnProxQuiz").click();
      }
      if(e.code==="Space"){ e.preventDefault(); if(telas.fase.classList.contains("ativa")) tocarItemAtual(); }
      if(e.key==="r"||e.key==="R"){ if(telas.quiz.classList.contains("ativa")) iniciarQuiz(); }
    }

    /* ===== Utils ===== */
    function qs(s){ return document.querySelector(s); }
    function qsAll(s){ return [...document.querySelectorAll(s)]; }
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
  </script>
</body>
</html>
